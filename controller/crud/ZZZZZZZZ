<!--   insert book form  -->

<?php /*
    <!--template for insert product details-->
    <form method="post" class="form">

<!------------------------------------------------------------------------------------------ID-->
        <label for="product_id">Product ID</label>
        <?= html_input('text', 'product_id') ?>
        <?= err('product_id') ?>
        
<!-----------------------------------------------------------------------------------------NAME-->
        <label for="product_name">Product Name</label>
        <?= html_input('text', 'product_name') ?>
        <?= err('product_name') ?>
        
<!-------------------------------------------------------------------------------------------PRICE-->
        <label for="price">Price</label>
        <?= html_input('number', 'price', 'min="0.5" max="9999.99", step="0.01"') ?>
        <?= err('price') ?>
                
<!-----------------------------------------------------------------------------------------CATEGORY-->
        <label for="category">Category</label>
        <div>
            <input type="text" id="category" name="detail_id" list="cat_name_list">
            <input type="text" id="category" name="category_id" list="cat_id_list">
        </div>
        <?= err('category') ?>
        
<!-----------------------------------------------------------------------------------------GENRE-->
        <label for="genre">Genre</label>
        <?=  html_input('text', 'genre') ?>
        <?= err('genre') ?>
        
<!-----------------------------------------------------------------------------------------PUBLISHER-->
        <label for="publisher">Publisher</label>
        <?= html_input('text', 'publisher') ?>
        <?= err('publisher') ?>  

<!-----------------------------------------------------------------------------------------DATE-->
        <label for="publish_date">Publish Date</label>
        <?= html_input('date', 'publish_date') ?>
        <?= err('publish_date') ?>
        
<!-----------------------------------------------------------------------------------------AUTHOR-->
        <label for="author">Author</label>
        <?= html_input('text', 'author') ?>
        <?= err('author') ?>  

<!-----------------------------------------------------------------------------------------KEYWORD-->
        <label for="keyword">Keyword</label>
        <?= html_input('text', 'keyword') ?>
        <?= err('keyword') ?>

<!-----------------------------------------------------------------------------------------STOCK-->
        <label for="stock">Stock</label>
        <?= html_input('number', 'stock', "min='1', max='999999' step='1'") ?>
        <?= err('stock') ?>
        

<!-----------------------------------------------------------------------------------------image-->       
        <label for="image" class="image">Product Picture</label>
        <input type="file" id="image" name="image" accept="image/*">
        <?= err('image') ?>
*/?>

****************************************************************************************************************************
<!--upload form  -->

<!--<form action="upload.php" method="POST" enctype="multipart/form-data">
        <div class="upload-box">
            <input type="file" name="image" id="image">
            <label for="image">Choose an Image</label>
        </div>
        <br><br>
        <button type="submit" name="upload">Upload</button>
    </form>-->

****************************************************************************************************************************
    // Input
    /*
    $product_id         = req('product_id');
    $product_name       = req('product_name');
    $price              = req('price');
    $detail_id          = req('detail_id');
    $category_id        = req('category_id');
    $genre              = req('genre');
    $publisher          = req('publisher');
    $publish_date       = req('publish_date');
    $author             = req('author');
    $keyword            = req('keyword');
    $stock              = req('stock');
    $image              = req('image');
 /*   var_dump($stock);
    die();*/

    // Validate id
    /*
    if ($product_id == '') {
        $_err['product_id'] = 'Required';
    } else {

    }

    // Validate name
    if ($product_name == '') {
        $_err['product_name'] = 'Required';
    }
    else if (strlen($product_name) > 80) {
        $_err['product_name'] = 'Maximum length 100';
    }

    // Validate price
    if ($price == '') {
        $_err['price'] = 'Required';
    }

    // Validate category
    if ($category_id == '' || $detail_id == '') {
        $_err['category'] = 'Required';
    }

    // Validate genre
    if ($genre == '') {
        $_err['genre'] = 'Required';
    }

    // Validate publisher
    if ($publisher == '') {
        $_err['publisher'] = 'Required';
    }

    // Validate publish_date
    if ($publish_date == '') {
        $_err['publish_date'] = 'Required';
    }

    // Validate author
    if ($author == '') {
        $_err['author'] = 'Required';
    }

    // Validate keyword
    if ($keyword == '') {
        $_err['keyword'] = 'Required';
    }

    //validate stock
    if ($stock == '') {
        $_err['stock'] = 'Required';
    }

    //validate image
    if ($image == '') {
        $_err['image'] = 'Required';
    }
*/

****************************************************************************************************************************
// Input
    /*
    $BS = req('BS');
    if ($BS == 'BOOK' || $BS == null) {
        $input = [
            'product_id'      =>  $product_id         = req('product_id'),
            'name'            =>  $name               = req('name'),
            'price'           =>  $price              = req('price'),
            'category_id'     =>  $category_id        = req('category_id'),
            'genre'           =>  $genre              = req('genre'),
            'publisher'       =>  $publisher          = req('publisher'),
            'publish_date'    =>  $publish_date       = req('publish_date'),
            'author'          =>  $author             = req('author'),
            'keywords'        =>  $keywords           = req('keywords'),
            'stock'           =>  $stock              = req('stock'),
            'image'           =>  $image              = req('image')
        ];    
    } else {
        $input = [
            'product_id'      =>  $product_id         = req('product_id'),
            'name'            =>  $name               = req('name'),
            'price'           =>  $price              = req('price'),
            'category_id'     =>  $category_id        = req('category_id'),
            'genre'           =>  $genre              = req('genre'),
            'brand'           =>  $brand              = req('brand'),
            'material'        =>  $material           = req('material'),
            'keywords'        =>  $keywords           = req('keywords'),
            'stock'           =>  $stock              = req('stock'),
            'image'           =>  $image              = req('image')
        ];    
    }
    */

****************************************************************************************************************************
//preview picture restore
    $('label.upload input[type=file]').on('change', e => {
    const f = e.target.files[0]; // Get selected file
    const img = $(e.target).siblings('img')[0]; // Find the <img> next to input

    if (!img) return; // If no <img> exists, stop

    // Save the original image only once
    img.dataset.src ??= img.src;

    // If it's an image, update the preview and store it
    if (f?.type.startsWith('image/')) {
        const newPreview = URL.createObjectURL(f);
        img.src = newPreview;
        img.dataset.preview = newPreview; // Save last valid image
    }
});

// Restore the last valid preview if form submission fails
function restoreImageOnInvalidForm() {
    $('label.upload img').each(function () {
        if (this.dataset.preview) {
            this.src = this.dataset.preview; // Restore last valid preview
        }
    });
}

// Example: Attach to form submission validation
$('form').on('submit', function (e) {
    if (!isFormValid()) { // Replace with your actual validation function
        e.preventDefault(); // Stop form submission
        restoreImageOnInvalidForm(); // Restore last valid preview
        alert("Form is invalid! Fix errors before submitting.");
    }
});

// Example validation function (replace with your logic)
function isFormValid() {
    let isValid = true;
    
    // Example: Check if required inputs are filled
    $('input[required], select[required], textarea[required]').each(function () {
        if (!this.value.trim()) {
            isValid = false;
        }
    });

    return isValid;
}
